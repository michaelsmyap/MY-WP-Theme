/**
  * Dynamic-Carousel - responsive carousel
  * Version: ?
  * Project Page:  https://github.com/Wilto/Dynamic-Carousel
  * Requirements:  jQuery
  * Usage Example: 
  *
  * Author: Mat Marquis (@wilto)
  * 
  * License: MIT License
  *
 **/ 
(function(a,b){var c=0;a.fn.getPercentage=function(){var a=this.attr("style").match(/margin\-left:(.*[0-9])/i)&&parseInt(RegExp.$1);return a};a.fn.adjRounding=function(b){var c=a(this),d=c.find(b),e=c.parent().width()-d.eq(0).width();if(e!==0){d.css("position","relative");for(var f=0;f<d.length;f++){d.eq(f).css("left",e*f+"px")}}return this};a.fn.carousel=function(d){if(this.data("carousel-initialized")){return}this.data("carousel-initialized",true);var e={slider:".slider",slide:".slide",prevSlide:null,nextSlide:null,slideHed:null,addPagination:false,addNav:d!=b&&(d.prevSlide||d.nextSlide)?false:true,namespace:"carousel",speed:300},f=a.extend(e,d),g=this,h=document.body||document.documentElement,i=function(){h.setAttribute("style","transition:top 1s ease;-webkit-transition:top 1s ease;-moz-transition:top 1s ease;");var a=!!(h.style.transition||h.style.webkitTransition||h.style.msTransition||h.style.OTransition||h.style.MozTransition);return a},j={init:function(){c++;g.each(function(b){var d=a(this),e=d.find(f.slider),g=d.find(f.slide),h=g.length,i="margin-left "+f.speed/1e3+"s ease",k="carousel-"+c+"-"+b;if(g.length<=1){return}d.css({overflow:"hidden",width:"100%"}).attr("role","application");e.attr("id",e[0].id||"carousel-"+c+"-"+b).css({marginLeft:"0px","float":"left",width:100*h+"%","-webkit-transition":i,"-moz-transition":i,"-ms-transition":i,"-o-transition":i,transition:i}).bind("carouselmove",j.move).bind("nextprev",j.nextPrev).bind("navstate",j.navState);g.css({"float":"left",width:100/h+"%"}).each(function(b){var c=a(this);c.attr({role:"tabpanel document",id:k+"-slide"+b});if(f.addPagination){c.attr("aria-labelledby",k+"-tab"+b)}});f.addPagination&&j.addPagination();f.addNav&&j.addNav();e.trigger("navstate",{current:0})})},addNav:function(){g.each(function(b){var c=a(this),d=c.find(f.slider),e=d[0].id,g=['<ul class="slidecontrols" role="navigation">','	<li role="presentation"><a href="#'+e+'" class="'+f.namespace+'-next">Next</a></li>','	<li role="presentation"><a href="#'+e+'" class="'+f.namespace+'-prev">Prev</a></li>',"</ul>"].join(""),h={nextSlide:"."+f.namespace+"-next",prevSlide:"."+f.namespace+"-prev"};f=a.extend(f,h);c.prepend(g)})},addPagination:function(){g.each(function(b){var d=a(this),e=a('<ol class="'+f.namespace+'-tabs" role="tablist navigation" />'),g=d.find(f.slider),h=d.find(f.slide);slideNum=h.length,associated="carousel-"+c+"-"+b;while(slideNum--){var i=h.eq(slideNum).find(f.slideHed).text()||"Page "+(slideNum+1),j=['<li role="presentation">','<a href="#'+associated+"-slide"+slideNum+'"',' aria-controls="'+associated+"-slide"+slideNum+'"',' id="'+associated+"-tab"+slideNum+'" role="tab">'+i+"</a>","</li>"].join("");e.prepend(j)}e.appendTo(d).find("li").keydown(function(b){var c=a(this),d=c.prev().find("a"),e=c.next().find("a");switch(b.which){case 37:case 38:d.length&&d.trigger("click").focus();b.preventDefault();break;case 39:case 40:e.length&&e.trigger("click").focus();b.preventDefault();break}}).find("a").click(function(b){var c=a(this);if(c.attr("aria-selected")=="false"){var e=c.parent().index(),g=-(100*e),h=d.find(f.slider);h.trigger("carouselmove",{moveTo:g})}b.preventDefault()})})},roundDown:function(a){var b=parseInt(a,10);return Math.ceil((b-b%100)/100)*100},navState:function(b,c){var d=a(this),e=d.find(f.slide),g=-(c.current/100),h=e.eq(g);d.attr("aria-activedescendant",h[0].id);h.addClass(f.namespace+"-active-slide").attr("aria-hidden",false).siblings().removeClass(f.namespace+"-active-slide").attr("aria-hidden",true);if(!!f.prevSlide||!!f.nextSlide){var i=a('[href*="#'+this.id+'"]');i.removeClass(f.namespace+"-disabled");if(g==0){i.filter(f.prevSlide).addClass(f.namespace+"-disabled")}else if(g==e.length-1){i.filter(f.nextSlide).addClass(f.namespace+"-disabled")}}if(!!f.addPagination){var j=h.attr("aria-labelledby"),k=a("#"+j);k.parent().addClass(f.namespace+"-active-tab").siblings().removeClass(f.namespace+"-active-tab").find("a").attr({"aria-selected":false,tabindex:-1});k.attr({"aria-selected":true,tabindex:0})}},move:function(b,c){var d=a(this);d.trigger(f.namespace+"-beforemove").trigger("navstate",{current:c.moveTo});if(i()){d.adjRounding(f.slide).css("marginLeft",c.moveTo+"%").one("transitionend webkitTransitionEnd OTransitionEnd",function(){a(this).trigger(f.namespace+"-aftermove")})}else{d.adjRounding(f.slide).animate({marginLeft:c.moveTo+"%"},{duration:f.speed,queue:false},function(){a(this).trigger(f.namespace+"-aftermove")})}},nextPrev:function(b,c){var d=a(this),e=d?d.getPercentage():0,g=d.find(f.slide),h=c.dir==="prev"?e!=0:-e<(g.length-1)*100,i=a('[href="#'+this.id+'"]');if(!d.is(":animated")&&h){if(c.dir==="prev"){e=e%100!=0?j.roundDown(e):e+100}else{e=e%100!=0?j.roundDown(e)-100:e-100}d.trigger("carouselmove",{moveTo:e});i.removeClass(f.namespace+"-disabled").removeAttr("aria-disabled");switch(e){case-(g.length-1)*100:i.filter(f.nextSlide).addClass(f.namespace+"-disabled").attr("aria-disabled",true);break;case 0:i.filter(f.prevSlide).addClass(f.namespace+"-disabled").attr("aria-disabled",true);break}}else{var k=j.roundDown(e);d.trigger("carouselmove",{moveTo:k})}}};j.init(this);a(f.nextSlide+","+f.prevSlide).bind("click",function(b){var c=a(this),d=this.hash,e=c.is(f.prevSlide)?"prev":"next",g=a(d);if(c.is("."+f.namespace+"-disabled")){return false}g.trigger("nextprev",{dir:e});b.preventDefault()}).bind("keydown",function(b){var c=a(this),d=this.hash;switch(b.which){case 37:case 38:a("#"+d).trigger("nextprev",{dir:"next"});b.preventDefault();break;case 39:case 40:a("#"+d).trigger("nextprev",{dir:"prev"});b.preventDefault();break}});var k={wrap:this,slider:f.slider};g.bind("dragSnap",k,function(b,c){var d=a(this).find(f.slider),e=c.direction==="left"?"next":"prev";d.trigger("nextprev",{dir:e})});g.filter("[data-autorotate]").each(function(){var b,c=a(this),d=c.attr("data-autorotate"),e=c.find(f.slide).length,g=function(){var h=c.find(f.slider),i=-(a(f.slider).getPercentage()/100)+1;switch(i){case e:clearInterval(b);b=setInterval(function(){g();h.trigger("nextprev",{dir:"prev"})},d);break;case 1:clearInterval(b);b=setInterval(function(){g();h.trigger("nextprev",{dir:"next"})},d);break}};b=setInterval(g,d);c.attr("aria-live","polite").bind("mouseenter click touchstart",function(){clearInterval(b)})});return this};a.event.special.dragSnap={setup:function(c){var d=a(this),e=function(a,b){var c=.3,d=b?"margin-left "+c+"s ease":"none";a.css({"-webkit-transition":d,"-moz-transition":d,"-ms-transition":d,"-o-transition":d,transition:d})},f=function(a){var a=parseInt(a,10);return Math.ceil((a-a%100)/100)*100},g=function(a,c){var d=c.target,g=d.attr("style")!=b?d.getPercentage():0,h=c.left===false?f(g)-100:f(g),i=document.body,j=function(){i.setAttribute("style","transition:top 1s ease;-webkit-transition:top 1s ease;-moz-transition:top 1s ease;");var a=!!(i.style.transition||i.style.webkitTransition||i.style.MozTransition);return a};e(d,true);if(j()){d.css("marginLeft",h+"%")}else{d.animate({marginLeft:h+"%"},opt.speed)}};d.bind("snapback",g).bind("touchstart",function(f){function m(a){var b=a.originalEvent.touches?a.originalEvent.touches[0]:a;j={time:+(new Date),coords:[b.pageX,b.pageY]},deltaX=Math.abs(i.coords[0]-b.pageX),deltaY=Math.abs(i.coords[1]-b.pageY);if(!i||deltaX<deltaY||deltaX<55){return}if(deltaX>=55){i.interacting=true;k.css({"margin-left":l+(j.coords[0]-i.coords[0])/i.origin.width()*100+"%"});a.preventDefault()}else{return}}var g=f.originalEvent.touches?f.originalEvent.touches[0]:f,h=a(f.target),i={time:+(new Date),coords:[g.pageX,g.pageY],origin:h.closest(c.wrap),interacting:false},j,k=h.closest(c.slider),l=k.attr("style")!=b?k.getPercentage():0;e(k,false);d.bind("gesturestart",function(a){d.unbind("touchmove",m).unbind("touchend",m)}).bind("touchmove",m).one("touchend",function(a){d.unbind("touchmove",m);e(k,true);if(i&&j){var c=Math.abs(i.coords[0]-j.coords[0]),f=Math.abs(i.coords[1]-j.coords[1]),g=i.coords[0]>j.coords[0],h;if(c>20&&c>f){a.preventDefault()}else{if(i.interacting){d.trigger("snapback",{target:k,left:g})}return}h=i.origin.width()/4;if(-c>h||c>h){i.origin.trigger("dragSnap",{direction:g?"left":"right"})}else{d.trigger("snapback",{target:k,left:g})}}i=j=b})})}}})(jQuery)